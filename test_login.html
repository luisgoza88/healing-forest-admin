<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Login - Healing Forest Admin</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Test Login Page</h1>
    <div id="status">Initializing Firebase...</div>
    <br>
    <button onclick="testLogin()">Test Login</button>
    <br><br>
    <div id="results"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAlOrxlLbZV-ZzxDcFrretv2dycKtF4dyM",
            authDomain: "healling-forest.firebaseapp.com",
            projectId: "healling-forest",
            storageBucket: "healling-forest.firebasestorage.app",
            messagingSenderId: "657330224656",
            appId: "1:657330224656:web:admin"
        };

        let auth, db;
        const status = document.getElementById('status');
        const results = document.getElementById('results');

        try {
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            status.textContent = 'Firebase initialized successfully!';
            status.style.color = 'green';
        } catch (error) {
            status.textContent = 'Error initializing Firebase: ' + error.message;
            status.style.color = 'red';
            console.error('Firebase initialization error:', error);
        }

        async function testLogin() {
            results.innerHTML = '<p>Testing login...</p>';
            
            const testEmail = 'admin@healingforest.com';
            const testPassword = 'admin123';
            
            try {
                results.innerHTML += '<p>Attempting login with: ' + testEmail + '</p>';
                
                const userCredential = await auth.signInWithEmailAndPassword(testEmail, testPassword);
                const user = userCredential.user;
                
                results.innerHTML += '<p style="color: green;">Login successful! User ID: ' + user.uid + '</p>';
                
                // Try to get user document
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        results.innerHTML += '<p>User data: ' + JSON.stringify(userData) + '</p>';
                    } else {
                        results.innerHTML += '<p style="color: orange;">User document not found in Firestore</p>';
                    }
                } catch (dbError) {
                    results.innerHTML += '<p style="color: red;">Firestore error: ' + dbError.message + '</p>';
                }
                
            } catch (error) {
                results.innerHTML += '<p style="color: red;">Login error: ' + error.message + '</p>';
                results.innerHTML += '<p>Error code: ' + error.code + '</p>';
                
                if (error.code === 'auth/user-not-found') {
                    results.innerHTML += '<p>The user does not exist. You may need to create it first.</p>';
                } else if (error.code === 'auth/wrong-password') {
                    results.innerHTML += '<p>The password is incorrect.</p>';
                } else if (error.code === 'auth/invalid-email') {
                    results.innerHTML += '<p>The email format is invalid.</p>';
                }
            }
        }

        // Check current auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                results.innerHTML += '<p style="color: blue;">Already logged in as: ' + user.email + '</p>';
            }
        });
    </script>
</body>
</html>